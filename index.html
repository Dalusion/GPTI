<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Tax Efficiency Index</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; color: #333; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        p.subtitle { text-align: center; font-style: italic; color: #7f8c8d; margin-bottom: 30px; }
        table { width: 90%; margin: 0 auto; border-collapse: collapse; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #3498db; color: white; font-weight: bold; cursor: pointer; }
        th:hover { background-color: #2980b9; }
        tr:nth-child(even) { background-color: #ecf0f1; }
        tr:hover { background-color: #dfe6e9; }
        .green { background-color: #2ecc71; }
        .yellow { background-color: #f1c40f; }
        .orange { background-color: #e67e22; }
        .red { background-color: #e74c3c; }
    </style>
</head>
<body>
    <h1>2025 Tax Efficiency Index</h1>
    <p class="subtitle">Ranking countries by tax burden vs. government performance</p>
    <table id="taxTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">Rank</th>
                <th onclick="sortTable(1)">Country</th>
                <th onclick="sortTable(2)">Tax-to-GDP (%)</th>
                <th onclick="sortTable(3)">HDI</th>
                <th onclick="sortTable(4)">Gov. Effectiveness</th>
                <th onclick="sortTable(5)">Index Score</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
    <footer style="text-align: center; margin-top: 30px; font-size: 0.9em; color: #7f8c8d;">
        <p>Index Score = (HDI + Gov. Effectiveness) / max(Tax-to-GDP / 100, 0.15). Data from OECD, UNDP, World Bank (2023/2024).</p>
        <p>Built by dalusion with help from Grok (xAI).</p>
    </footer>
    <script>
        let sortDirection = 5; // Default sort by Index Score
        let sortAsc = false;

        fetch('data.csv')
            .then(response => response.text())
            .then(data => {
                const rows = data.trim().split('\n').slice(1);
                const tbody = document.getElementById('tableBody');
                const scores = rows.map(row => parseFloat(row.split(',')[5]));
                const sortedScores = [...scores].sort((a, b) => a - b);
                const q1 = sortedScores[Math.floor(sortedScores.length * 0.25)];
                const q2 = sortedScores[Math.floor(sortedScores.length * 0.5)];
                const q3 = sortedScores[Math.floor(sortedScores.length * 0.75)];

                rows.forEach(row => {
                    const cols = row.split(',');
                    const tr = document.createElement('tr');
                    cols.forEach((col, idx) => {
                        const td = document.createElement('td');
                        td.textContent = col;
                        if (idx === 5) { // Index Score column
                            const score = parseFloat(col);
                            if (score >= q3) td.classList.add('green');
                            else if (score >= q2) td.classList.add('yellow');
                            else if (score >= q1) td.classList.add('orange');
                            else td.classList.add('red');
                        }
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                sortTable(5);
            });

        function sortTable(col) {
            const table = document.getElementById('taxTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            if (sortDirection === col) sortAsc = !sortAsc;
            else { sortDirection = col; sortAsc = true; }

            rows.sort((a, b) => {
                let aVal = a.cells[col].textContent;
                let bVal = b.cells[col].textContent;
                if (col > 1) {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                    return sortAsc ? aVal - bVal : bVal - aVal;
                }
                return sortAsc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });

            rows.forEach((row, idx) => row.cells[0].textContent = idx + 1);
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }
    </script>
</body>
</html>
